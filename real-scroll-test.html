<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0, viewport-fit=cover">
    <title>Test Rzeczywisty - Elite Capital Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #0D1B2A;
            color: white;
            line-height: 1.6;
            overflow-x: auto;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: manipulation;
        }
        
        .test-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px;
            z-index: 10000;
            font-size: 12px;
            border-bottom: 2px solid #D4AF37;
        }
        
        .test-controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.9);
            padding: 10px;
            z-index: 10000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .test-button {
            background: #D4AF37;
            color: #0D1B2A;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .test-button:hover {
            background: #B8941F;
        }
        
        .test-button.danger {
            background: #dc3545;
            color: white;
        }
        
        .test-button.success {
            background: #28a745;
            color: white;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-indicator.good {
            background: #28a745;
        }
        
        .status-indicator.warning {
            background: #ffc107;
        }
        
        .status-indicator.bad {
            background: #dc3545;
        }
        
        .test-frame {
            width: 100%;
            height: calc(100vh - 120px);
            border: none;
            margin-top: 60px;
        }
        
        .log-panel {
            position: fixed;
            top: 60px;
            right: 10px;
            width: 300px;
            height: 200px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #D4AF37;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 10px;
            overflow-y: auto;
            z-index: 9999;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="test-overlay">
        <span class="status-indicator" id="scrollStatus">‚óè</span>
        <strong>Test Scrollowania - Elite Capital Management</strong>
        <span id="scrollInfo">Scroll: 0px | Viewport: 0x0</span>
    </div>
    
    <div class="log-panel" id="logPanel">
        <strong>Log Test√≥w:</strong><br>
        <div id="logContent"></div>
    </div>
    
    <iframe src="index.html" class="test-frame" id="testFrame"></iframe>
    
    <div class="test-controls">
        <button class="test-button" onclick="toggleLog()">üìã Log</button>
        <button class="test-button" onclick="testScroll()">üß™ Test Scroll</button>
        <button class="test-button" onclick="testTouch()">üëÜ Test Dotyk</button>
        <button class="test-button" onclick="testPerformance()">‚ö° Performance</button>
        <button class="test-button" onclick="injectScrollFix()">üîß Napraw Scroll</button>
        <button class="test-button danger" onclick="clearLog()">üóëÔ∏è Wyczy≈õƒá</button>
        <button class="test-button success" onclick="generateReport()">üìä Raport</button>
    </div>

    <script>
        let testResults = {
            scrollTests: [],
            touchTests: [],
            performanceTests: [],
            issues: []
        };
        
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warning' ? '#ffd43b' : '#ffffff';
            logContent.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logContent.scrollTop = logContent.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function updateScrollInfo() {
            const scrollInfo = document.getElementById('scrollInfo');
            const scrollStatus = document.getElementById('scrollStatus');
            
            const scrollY = window.scrollY;
            const scrollX = window.scrollX;
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            
            scrollInfo.textContent = `Scroll: ${scrollY}px (X: ${scrollX}px) | Viewport: ${viewportWidth}x${viewportHeight}`;
            
            // Update status indicator
            if (scrollY > 0) {
                scrollStatus.className = 'status-indicator good';
            } else {
                scrollStatus.className = 'status-indicator warning';
            }
        }
        
        function testScroll() {
            log('üß™ Rozpoczƒôcie testu scrollowania...', 'info');
            
            const frame = document.getElementById('testFrame');
            const frameDoc = frame.contentDocument || frame.contentWindow.document;
            
            if (!frameDoc) {
                log('‚ùå Nie mo≈ºna uzyskaƒá dostƒôpu do iframe', 'error');
                return;
            }
            
            // Test 1: Check if page is scrollable
            const body = frameDoc.body;
            const html = frameDoc.documentElement;
            
            const bodyStyle = getComputedStyle(body);
            const htmlStyle = getComputedStyle(html);
            
            const bodyOverflow = bodyStyle.overflow;
            const htmlOverflow = htmlStyle.overflow;
            const bodyOverflowY = bodyStyle.overflowY;
            const htmlOverflowY = htmlStyle.overflowY;
            
            log(`Body overflow: ${bodyOverflow}, overflow-y: ${bodyOverflowY}`, 'info');
            log(`HTML overflow: ${htmlOverflow}, overflow-y: ${htmlOverflowY}`, 'info');
            
            if (bodyOverflow === 'hidden' || htmlOverflow === 'hidden') {
                log('‚ùå Scroll mo≈ºe byƒá zablokowany przez overflow: hidden', 'error');
                testResults.issues.push('overflow-hidden-blocking-scroll');
            } else {
                log('‚úÖ Overflow properties OK', 'success');
            }
            
            // Test 2: Check document height
            const documentHeight = frameDoc.documentElement.scrollHeight;
            const viewportHeight = frame.contentWindow.innerHeight;
            
            log(`Document height: ${documentHeight}px`, 'info');
            log(`Viewport height: ${viewportHeight}px`, 'info');
            
            if (documentHeight > viewportHeight) {
                log('‚úÖ Dokument jest wy≈ºszy ni≈º viewport - scrollowanie mo≈ºliwe', 'success');
            } else {
                log('‚ö†Ô∏è Dokument nie jest wy≈ºszy ni≈º viewport', 'warning');
            }
            
            // Test 3: Check for fixed elements that might interfere
            const fixedElements = frameDoc.querySelectorAll('[style*="position: fixed"]');
            log(`Znaleziono ${fixedElements.length} element√≥w z position: fixed`, 'info');
            
            // Test 4: Check for overflow hidden on containers
            const hiddenOverflowElements = frameDoc.querySelectorAll('[style*="overflow: hidden"]');
            log(`Znaleziono ${hiddenOverflowElements.length} element√≥w z overflow: hidden`, 'info');
            
            testResults.scrollTests.push({
                timestamp: new Date(),
                bodyOverflow,
                htmlOverflow,
                documentHeight,
                viewportHeight,
                fixedElements: fixedElements.length,
                hiddenOverflowElements: hiddenOverflowElements.length
            });
            
            log('‚úÖ Test scrollowania zako≈Ñczony', 'success');
        }
        
        function testTouch() {
            log('üëÜ Rozpoczƒôcie testu dotyku...', 'info');
            
            const hasTouchSupport = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            const touchPoints = navigator.maxTouchPoints;
            const userAgent = navigator.userAgent;
            
            log(`Wsparcie dotyku: ${hasTouchSupport}`, 'info');
            log(`Maksymalne punkty dotyku: ${touchPoints}`, 'info');
            log(`User Agent: ${userAgent.substring(0, 50)}...`, 'info');
            
            if (hasTouchSupport) {
                log('‚úÖ Wsparcie dotyku dostƒôpne', 'success');
            } else {
                log('‚ö†Ô∏è Brak wsparcia dotyku (mo≈ºe byƒá desktop)', 'warning');
            }
            
            // Test touch events
            let touchEventsSupported = 0;
            const touchEvents = ['touchstart', 'touchmove', 'touchend', 'touchcancel'];
            
            touchEvents.forEach(event => {
                if (`on${event}` in window) {
                    touchEventsSupported++;
                }
            });
            
            log(`Wspierane eventy dotyku: ${touchEventsSupported}/${touchEvents.length}`, 'info');
            
            testResults.touchTests.push({
                timestamp: new Date(),
                hasTouchSupport,
                touchPoints,
                touchEventsSupported,
                userAgent: userAgent.substring(0, 100)
            });
            
            log('‚úÖ Test dotyku zako≈Ñczony', 'success');
        }
        
        function testPerformance() {
            log('‚ö° Rozpoczƒôcie testu wydajno≈õci...', 'info');
            
            const startTime = performance.now();
            
            // Simulate scroll performance test
            let scrollCount = 0;
            const testScroll = () => {
                window.scrollBy(0, 10);
                scrollCount++;
                
                if (scrollCount < 10) {
                    requestAnimationFrame(testScroll);
                } else {
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    const fps = (1000 / (duration / 10)).toFixed(1);
                    
                    log(`Test scrollowania: ${duration.toFixed(2)}ms dla 10 scroll√≥w`, 'info');
                    log(`Szacowane FPS: ${fps}`, 'info');
                    
                    if (fps > 30) {
                        log('‚úÖ Wydajno≈õƒá scrollowania OK', 'success');
                    } else {
                        log('‚ö†Ô∏è Wolne scrollowanie', 'warning');
                    }
                    
                    testResults.performanceTests.push({
                        timestamp: new Date(),
                        duration,
                        fps: parseFloat(fps),
                        scrollCount
                    });
                    
                    // Reset scroll position
                    window.scrollTo(0, 0);
                }
            };
            
            requestAnimationFrame(testScroll);
        }
        
        function injectScrollFix() {
            log('üîß Wstrzykiwanie naprawy scrollowania...', 'info');
            
            const frame = document.getElementById('testFrame');
            const frameWindow = frame.contentWindow;
            
            if (!frameWindow) {
                log('‚ùå Nie mo≈ºna uzyskaƒá dostƒôpu do iframe', 'error');
                return;
            }
            
            try {
                // Inject scroll fix script
                const script = frameWindow.document.createElement('script');
                script.textContent = `
                    // Emergency scroll fix
                    function emergencyScrollFix() {
                        const body = document.body;
                        const html = document.documentElement;
                        
                        // Force enable scroll
                        body.style.setProperty('overflow-x', 'auto', 'important');
                        body.style.setProperty('overflow-y', 'auto', 'important');
                        html.style.setProperty('overflow-x', 'auto', 'important');
                        html.style.setProperty('overflow-y', 'auto', 'important');
                        
                        // Enable touch scrolling
                        body.style.setProperty('-webkit-overflow-scrolling', 'touch', 'important');
                        html.style.setProperty('-webkit-overflow-scrolling', 'touch', 'important');
                        
                        console.log('üîß Emergency scroll fix applied');
                    }
                    
                    emergencyScrollFix();
                    setInterval(emergencyScrollFix, 2000);
                `;
                
                frameWindow.document.head.appendChild(script);
                log('‚úÖ Naprawa scrollowania wstrzykniƒôta', 'success');
                
            } catch (error) {
                log(`‚ùå B≈ÇƒÖd podczas wstrzykiwania: ${error.message}`, 'error');
            }
        }
        
        function toggleLog() {
            const logPanel = document.getElementById('logPanel');
            logPanel.classList.toggle('hidden');
        }
        
        function clearLog() {
            document.getElementById('logContent').innerHTML = '';
            testResults = {
                scrollTests: [],
                touchTests: [],
                performanceTests: [],
                issues: []
            };
            log('üóëÔ∏è Log wyczyszczony', 'info');
        }
        
        function generateReport() {
            log('üìä Generowanie raportu...', 'info');
            
            const report = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                viewport: {
                    width: window.innerWidth,
                    height: window.innerHeight
                },
                tests: testResults,
                summary: {
                    totalScrollTests: testResults.scrollTests.length,
                    totalTouchTests: testResults.touchTests.length,
                    totalPerformanceTests: testResults.performanceTests.length,
                    totalIssues: testResults.issues.length
                }
            };
            
            // Create downloadable report
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `scroll-test-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('‚úÖ Raport wygenerowany i pobrany', 'success');
        }
        
        // Initialize
        window.addEventListener('scroll', updateScrollInfo);
        window.addEventListener('resize', updateScrollInfo);
        
        // Initial update
        updateScrollInfo();
        
        // Auto-test after page load
        setTimeout(() => {
            log('üöÄ Strona za≈Çadowana - automatyczne testy...', 'info');
            setTimeout(testScroll, 1000);
            setTimeout(testTouch, 1500);
        }, 2000);
        
        log('üß™ Test rzeczywisty zainicjalizowany', 'success');
    </script>
</body>
</html>
